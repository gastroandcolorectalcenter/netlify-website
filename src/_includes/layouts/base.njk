<!DOCTYPE html>
<html lang="{{ site.language or 'en' }}">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  
  <!-- Content Security Policy (custom for Netlify + Google Script + Formspree) -->
  <meta http-equiv="Content-Security-Policy"
    content="`
        default-src 'self' https://*.netlify.app;
        script-src 'self' 'unsafe-inline' 'unsafe-eval'
            https://www.googletagmanager.com
            https://www.google.com
            https://www.gstatic.com
            https://www.recaptcha.net
            https://script.google.com
            https://*.googleusercontent.com;
        style-src 'self' 'unsafe-inline';
        img-src 'self' data:
            https://www.google.com
            https://www.gstatic.com
            https://www.googletagmanager.com
            https://*.netlify.app;
        font-src 'self';
        connect-src 'self'
            https://formspree.io
            https://www.google-analytics.com
            https://www.googletagmanager.com
            https://script.google.com
            https://*.googleusercontent.com
            https://wa.me;
        frame-src
            https://www.google.com
            https://www.recaptcha.net;
        form-action 'self' https://formspree.io https://script.google.com;
        object-src 'none';
        base-uri 'self';
        upgrade-insecure-requests;
    ">

  <!-- SEO Meta Tags -->
  <title>{{ title or site.title }}</title>
  <meta name="description" content="{{ description or site.description }}">
  <meta name="author" content="{{ site.author.name }}">
  <meta name="keywords" content="{{ keywords or site.seo.keywords | join(', ') }}">
  
  <!--  SEO & Robots & sitemap Meta Tags -->
  <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1">
  <meta name="googlebot" content="index, follow">
  <meta name="bingbot" content="index, follow">

  <!-- Canonical URL -->
  <link rel="canonical" href="{{ site.url }}{{ page.url }}">

  <!-- RSS Feed -->
  <link rel="alternate" type="application/rss+xml" title="{{ site.name }} - Blog Feed" href="{{ site.url }}/feed.xml">
  
  <!--  Favicon -->
  <link rel="icon" type="image/png" href="/assets/images/icons/favicon.svg">
  <link rel="apple-touch-icon" href="/assets/images/icons/apple-touch-icon.png">
 
  <!-- Preload hero image only for home page -->
  {% if page.url == "/" %}
    <link rel="preload" href="/assets/images/doctor/about-me1.webp" as="image" imagesrcset="/assets/images/doctor/about-me1.webp 400w" imagesizes="(max-width: 400px) 100vw, 380px">
  {% endif %}

  <!-- Web App Manifest -->
  <link rel="manifest" href="/site.webmanifest">
  <meta name="theme-color" content="#0066cc" media="(prefers-color-scheme: light)">
  <meta name="theme-color" content="#003366" media="(prefers-color-scheme: dark)">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Dr. Shah +">
  <!-- for app icons -->
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/images/icons/apple-touch-icon.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/assets/images/icons/apple-touch-icon-152.png">

  <style>
    body{margin: 0; padding: 0; font-family:-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;}
    /* Navbar*/
    .site-header{position: sticky; top: 0; z-index:1000;}
    .navbar{background:linear-gradient(135deg,#667eea 0,#764ba2 100%);box-shadow:0 2px 10px rgba(0,0,0,.1);backdrop-filter:blur(10px)}
    .nav-container{max-width:1200px;margin:0 auto;padding:0 1rem;display:flex;justify-content:space-between;align-items:center; min-height:70px}.nav-left{display:flex;align-items: center; gap:1rem}.logo{font-size:1.5rem;font-weight:700;color:whitesmoke;text-decoration:none;letter-spacing:-.5px;font-family: Georgia, serif;}.logo-text {display: inline-block;}
    .call-button{display:flex;align-items:center;gap:.5rem;background:rgba(255,255,255,.2);color:whitesmoke;padding:.6rem 1rem;border-radius:25px;text-decoration:none;font-size:.9rem;font-weight: 400; transition:.3s;backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,.1)}.call-icon{width:20px;height:20px;fill:currentColor}.nav-menu{display:flex;list-style:none;gap:0}.nav-item{position:relative;}
    .nav-link{color:whitesmoke;text-decoration:none;padding:.8rem 1rem;display:block;font-size: .95rem; font-weight: 400; transition:.3s;border-radius:8px;position:relative;overflow:hidden}
    .nav-apt{background:rgba(255,255,255,.2);border-radius:25px;margin-left:5px;backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,.1)}.menu-toggle{display:none;background:0 0;border:none;color:whitesmoke;font-size:1rem;cursor:pointer;padding:.5rem;border-radius:4px;transition:background-color .2s}
    .hamburger{display:block;width:25px;height:3px;background:whitesmoke;margin:5px 0;transition:.3s;border-radius:2px}
    @media (max-width:480px){.nav-container{padding:0 .5rem;min-height:65px}.nav-left{gap:.5rem}.call-button{padding:.4rem .6rem;font-size:.8rem}.call-icon{width:16px;height:16px}}
    /* hero section */
    .hero-section{box-shadow: var(--shadow-md);border-bottom: .5px solid rgba(104 203 246 / 0.4); padding-top: 0; background: #ECF2FC;animation:.8s ease-out fadeInUp}
    @media (max-width: 748px) {.hero-image{order: -1;}}
    /* Hero container */
    .container-2columns{width: 100%; max-width:1200px;margin:0 auto;padding:3rem 1rem;display:flex;justify-content:center; position:relative;gap: 3rem; overflow:hidden}.container-left{flex:60%;text-align: center;}.container-left p{text-align: justify;} .container-right{flex: 40%;display: flex;align-items: center;}.container-right img{width:100%;height:auto;display: block;aspect-ratio: 1 / 1; border-radius:8px;box-shadow:var(--box-shadow)}
    @media (max-width:748px){.container-2columns{flex-direction:column;align-items:flex-start;gap: 0; padding:0} .container-left{padding:2rem 1rem}.container-right img{border-radius:0;box-shadow:none}}
    /*skip link*/
    .skip-link{position:absolute;top:-40px;left:6px;background:#1a202c;color:#ffffff;padding:8px 12px;text-decoration:none;border-radius:4px;z-index:1001}
    .skip-link:focus{top:6px}
  </style>
  
  <!-- Stylesheets -->
  <link rel="preload" href="/assets/css/main.css" as="style">
  <link rel="stylesheet" href="/assets/css/main.css">
  <link rel="stylesheet" href="/assets/css/navigation.css">
  <link rel="stylesheet" href="/assets/css/utilities.css">
  
  <!-- Blog-specific CSS - only load on blog pages -->
  {% if layout == "layouts/blog.njk" or page.url.startsWith('/blogs') %}
  <link rel="preload" href="/assets/css/blog.css" as="style">
  <link rel="stylesheet" href="/assets/css/blog.css">
  {% endif %}

  <!-- Services-specific CSS - only load on services pages -->
  {% if layout == "layouts/services.njk" or page.url.startsWith('/services') %}
  <link rel="preload" href="/assets/css/services.css" as="style">
  <link rel="stylesheet" href="/assets/css/services.css">
  {% endif %}

  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="{{ ogType or 'website' }}">
  <meta property="og:url" content="{{ site.url }}{{ page.url }}">
  <meta property="og:title" content="{{ title or site.title }}">
  <meta property="og:description" content="{{ description or site.description }}">
  <meta property="og:image" content="{{ site.url }}{{ ogImage or site.seo.ogImage }}">
  <meta property="og:locale" content="{{ site.locale }}">
  
  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:url" content="{{ site.url }}{{ page.url }}">
  <meta name="twitter:title" content="{{ title or site.title }}">
  <meta name="twitter:description" content="{{ description or site.description }}">
  <meta name="twitter:image" content="{{ site.url }}{{ ogImage or site.seo.ogImage }}">
  <meta name="twitter:site" content="{{ site.seo.twitterHandle }}">
  
  <!-- JSON-LD Structured Data / Schema.org markup for Google -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "{{ site.business.type }}",
    "name": "{{ site.name }}",
    "@id": "https://www.drsurendrashah.com.np#person",
    "image": "{{site.seo.ogImage}}",
    "jobTitle": "{{site.tite}}",
    "description": "{{ site.description }}",
    "medicalSpecialty": [
        "Gastrointestinal Surgery",
        "HPB Surgery",
        "Colorectal Surgery",
        "Laparoscopic Surgery",
        "Laser Proctology",
        "Laser Treatment for Varicose Vein",
        "Hernia Surgery"
      ],
    "url": "{{ site.url }}",
    "contactPoint": {
      "@type": "contactPoint",
      "telephone": "{{ site.contact.phone }}",
      "email": "{{ site.contact.email }}",
      "contactType": "Appointment",
      "addressLocality": "{{ site.contact.address.city }}",
      "addressRegion": "{{ site.contact.address.state }}",
      "postalCode": "{{ site.contact.address.zip }}",
      "addressCountry": "{{ site.contact.address.country }}"
    },
    "sameAs": [
        "https://www.facebook.com/docsurendrashah",
        "https://www.linkedin.com/in/drsurendrashah/",
        "https://twitter.com/drsurendrashah",
        "https://www.instagram.com/dr_surendrashah/",
        "https://www.tiktok.com/@dr.surendrashah",
        "https://share.google/j1fzEHU6BFhMWKvyN"
      ],
    "priceRange": "{{ site.business.priceRange }}",
    "openingHoursSpecification": [
      {% for hours in site.business.openingHours %}
      {
        "@type": "OpeningHoursSpecification",
        "dayOfWeek": "{{ hours.split(' ')[0] }}",
        "opens": "{{ hours.split(' ')[1] }}"
      }{% if not loop.last %},{% endif %}
      {% endfor %},

      {
        "@type": "MedicalOrganization",
        "@id": "https://www.drsurendrashah.com.np#organization",
        "name": "Dr. Surendra Shah - Gastrointestinal & Laparoscopic Surgeon",
        "url": "https://www.drsurendrashah.com.np",
        "logo": "https://www.drsurendrashah.com.np/img/logo.png",
        "priceRange": "$$",
        "telephone": "+9779828070226"
      }
    ]
  }
  </script>

  <!-- Page Specifit JSON-LD Structured Data -->
  {% if schema %}
  <script type="application/ld+json">
  {{ schema | dump | safe }}
  </script>
  {% endif %}

  
  <!-- JavaScript -->
  <script src="/assets/js/main.js" defer></script>
  <script src="/assets/js/navigation.js" defer></script>
  <script src="/assets/js/smooth-scroll.js" defer></script>
  <script src="/assets/js/faq.js" defer></script>
  
  <!-- Blog-specific JS - only load on blog pages -->
  {% if layout == "layouts/blog.njk" or page.url.startsWith('/blogs') %}
  <script src="/assets/js/blog.js" defer></script>
  {% endif %}

  <!-- Deferred Google Analytics -->
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){ dataLayer.push(arguments); }
    
    let analyticsLoaded = false;
    function loadGoogleAnalytics() {
      if (analyticsLoaded) return;
      analyticsLoaded = true;
      
      const gaScript = document.createElement('script');
      gaScript.src = 'https://www.googletagmanager.com/gtag/js?id=G-T2N4Z17DHS';
      gaScript.async = true;
      document.head.appendChild(gaScript);
      
      gtag('js', new Date());
      gtag('config', 'G-T2N4Z17DHS', {
        anonymize_ip: true,
        transport_type: 'beacon'
      });
    }
    
    ['scroll', 'click', 'touchstart'].forEach(evt =>
      window.addEventListener(evt, loadGoogleAnalytics, { once: true })
    );
    
    setTimeout(loadGoogleAnalytics, 10000);
  </script>
</head>
<body>
  {# Skip to main content for accessibility #}
  <a href="#main-content" class="skip-link">Skip to main content</a>
  
  {# Header #}
  {% include "partials/header.njk" %}
  
  {# Main Content #}
  <main id="main-content" tabindex="-1" role="main" aria-label="main-content">
    {{ content | safe }}
  </main>
  
  {# Footer #}
  {% include "partials/footer.njk" %}

  {# Page specific js #}

  {% if popup %}
    <script src="/assets/js/popup.js" defer></script>
  {% endif %}
</body>
</html>
